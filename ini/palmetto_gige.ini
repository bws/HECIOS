# This file is shared by all PFS simulations

[General]
preload-ned-files = @/parl/bradles/software/hecios/lib/ned/hecios_ned.lst
sim-time-limit = 10000s

network = Palmetto

[Cmdenv]
express-mode = yes

[Tkenv]
default-run=1

[OutVectors]
**.SPFS*.enabled = yes
**.enabled = no

[Parameters]
###############################################################################
#
# Settings for the Beowulf Cluster configuration
#
###############################################################################
Palmetto.numCPUNodes = 1
Palmetto.numIONodes = 1
Palmetto.cpun[*].numProcs = 1

###############################################################################
#
# Settings for the client/end user application
#
#   Note that in the UMD trace filename, "%r" will be replaced with the 
#   application's process rank.
#
###############################################################################
**.mpi.IOApplicationType = "PHTFIOApplication"
**.mpi.app.disableCPUPhase = true
**.mpi.app.maxBeginTime = 0.002
**.mpi.app.traceFile = ""
#**.mpi.app.traceFile = "/data/traces/phtf/mpi-io-test_64p"
#**.mpi.app.traceFile = "/data/traces/phtf/mpi-io-test_128p"
#**.mpi.app.traceFile = "/data/traces/phtf/mpi-io-test_256p"
#**.mpi.app.traceFile = "/data/traces/phtf/flash-io_512p"

###############################################################################
#
# MPI Configuration settings
#
###############################################################################
Palmetto.mpiConfig.listenPortMin = 2000
Palmetto.mpiConfig.listenPortMax = 4000

###############################################################################
#
# MPI-IO Cache settings
#
###############################################################################
**.middlewareCacheType = "NoMiddlewareCache"
#Palmetto.cpun[*].process[*].middlewareCacheType = "DirectPagedMiddlewareCache"
#Palmetto.cpun[*].process[*].middlewareCacheType = "SharedDirectPagedMiddlewareCache"
#Palmetto.cpun[*].process[*].middlewareCacheType = "PagedMiddlewareCacheWithTwinNoBlockIndexed"
#Palmetto.cpun[*].process[*].middlewareCacheType = "SharedPagedMiddlewareCacheWithTwinNoBlockIndexed"
#Palmetto.cpun[*].process[*].middlewareCacheType = "PagedMiddlewareCacheWithTwin"
#Palmetto.cpun[*].process[*].middlewareCacheType = "SharedPagedMiddlewareCacheWithTwin"
Palmetto.cpun[*].process[*].cache.pageCapacity = 16
Palmetto.cpun[*].process[*].cache.pageSize = 32768

# Note we are assuming we can copy memory at 4GB/s (a reasonable estimate)
Palmetto.cpun[*].process[*].cache.byteCopyTime = .00000000023283064365

###############################################################################
#
# Parallel File System Client Configuration settings
#
###############################################################################
Palmetto.**.fsClient.useCollectiveCreate = false
Palmetto.**.fsClient.useCollectiveGetAttr = false
Palmetto.**.fsClient.useCollectiveRemove = false

Palmetto.**.fsClient.clientOverheadDelaySecs = 0.0
Palmetto.**.fsClient.directoryCreateProcessingDelaySecs = 0.0001
Palmetto.**.fsClient.directoryReadProcessingDelaySecs = 0.0009
Palmetto.**.fsClient.directoryRemoveProcessingDelaySecs = 0.0
Palmetto.**.fsClient.fileCloseProcessingDelaySecs = 0.0
Palmetto.**.fsClient.fileOpenProcessingDelaySecs = 0.0001
Palmetto.**.fsClient.fileReadProcessingDelaySecs = 0.0
Palmetto.**.fsClient.fileStatProcessingDelaySecs = 0.0001
Palmetto.**.fsClient.fileUpdateTimeProcessingDelaySecs = 0.0001
Palmetto.**.fsClient.fileWriteProcessingDelaySecs = 0.0


###############################################################################
#
# Parallel File System Server settings
#
###############################################################################
Palmetto.pfsConfig.serverOverheadDelaySecs = 0.0
Palmetto.pfsConfig.changeDirEntProcessingDelaySecs = 0.0      
Palmetto.pfsConfig.createDirEntProcessingDelaySecs = 0.0  
Palmetto.pfsConfig.createDFileProcessingDelaySecs = 0.0
Palmetto.pfsConfig.createDirectoryProcessingDelaySecs = 0.0   
Palmetto.pfsConfig.createMetadataProcessingDelaySecs = 0.0  
Palmetto.pfsConfig.getAttrProcessingDelaySecs = 0.0        
Palmetto.pfsConfig.lookupPathProcessingDelaySecs = 0.0    
Palmetto.pfsConfig.readDirProcessingDelaySecs = 0.0      
Palmetto.pfsConfig.removeDirEntProcessingDelaySecs = 0.0   
Palmetto.pfsConfig.removeMetaProcessingDelaySecs = 0.0   
Palmetto.pfsConfig.removeObjectProcessingDelaySecs = 0.0   
Palmetto.pfsConfig.setAttrProcessingDelaySecs = 0.0      

Palmetto.pfsConfig.metaDataSizeInBytes = 256 #ignored
Palmetto.pfsConfig.collectDiskData = false

###############################################################################
#
# Parallel File System Server DataFlow settings
#
###############################################################################
**.clientJobManager.bufferSizeInBytes = 262144
**.clientJobManager.numBuffers = 8
**.serverJobManager.bufferSizeInBytes = 262144
**.serverJobManager.numBuffers = 8

###############################################################################
#
# Settings for BMI TCP applications
#
###############################################################################
**.cpun[*].hca.tcpApp[*].listenPort = 6000
**.cpun[*].hca.tcpApp[*].connectPort = 6000
**.ion[*].hca.tcpApp[*].listenPort = 6000
**.ion[*].hca.tcpApp[*].connectPort = 6000

#
# Set the network startup costs for queue'ing and buffer copy
#
**.tcpApp[*].fixedOverheadSecs = 0.0
**.tcpApp[*].scaledOverheadSecs = 0.0

###############################################################################
#
# Settings for File System storage layer (Trove)
#
###############################################################################
**.trove.ioLibraryType = "ListIOLibrary"

###############################################################################
#
# Settings for Operating System
#
###############################################################################
**.os.systemCallInterfaceType = "SequentialSystemCallInterface"
**.os.fileSystemType = "NativeFileSystem"
**.os.bufferCacheType = "LRUBufferCache"
**.os.blockTranslatorType = "BasicTranslator"
**.os.diskSchedulerType = "FCFSDiskScheduler"
**.os.accessManagerType = "MutexAccessManager"

# Local Node OS Settings
#
# Configure a buffer cache filling 4GB RAM (assuming a 512 byte block size)
#**.os.bufferCache.dirtyThreshold = 0.0038
**.os.bufferCache.dirtyThreshold = 0.90
**.os.bufferCache.numEntries = 8388608
**.os.fileSystem.blockSizeBytes = 4096
**.os.systemCall.overheadSecs = 0.0000004		# 0.5 us
**.os.systemCall.addReadOverheadSecs = 0.0
**.os.systemCall.addWriteOverheadSecs = 0.0

###############################################################################
#
# Settings for Hard Disk drive on IONodes
#
# Palmetto uses 80GB WDC WD800JD-75MS Rev: 1Eo4
#
###############################################################################
#
# This needs to become the data for a  WDC WD800JD-75MS Rev: 1E04
#
**.hardDisk.numCylinders = 16383
**.hardDisk.numHeads = 2
**.hardDisk.numSectors = 156301488
**.hardDisk.tracksPerCylinder = 946
**.hardDisk.sectorsPerTrack = 63
**.hardDisk.rpm = 7200
**.hardDisk.fixedControllerReadOverheadSecs = 0.000205
**.hardDisk.fixedControllerWriteOverheadSecs = 0.000205
**.hardDisk.trackSwitchTimeSecs = 0.002
**.hardDisk.averageReadSeekSecs = 0.0088
**.hardDisk.averageWriteSeekSecs = 0.0103

###############################################################################
#
# Palmetto-like INET component configuration
#
# Switches are 48 port Dell PowerConnect 6248 and SMC 8848
# NICs are
#
###############################################################################

# Settings similar to a Dell PowerConnect 6248 (48-port 184Gb/s w/ 256 MB RAM)
# 95 Million Packets/s
#
Palmetto.switch.relayUnitType = "EnhancedMACRelayUnitPP"
Palmetto.switch.relayUnit.addressTableFile = ""
Palmetto.switch.relayUnit.addressTableSize = 8000
Palmetto.switch.relayUnit.agingTime = 0.0
Palmetto.switch.relayUnit.processingTime = 0.0000152
Palmetto.switch.relayUnit.bufferSizePerPort = 90000
Palmetto.switch.relayUnit.minBufferSize = 2200000
Palmetto.switch.relayUnit.maxBufferSize = 0
Palmetto.switch.relayUnit.highWatermark = 0
Palmetto.switch.relayUnit.pauseUnits = 0
Palmetto.switch.relayUnit.writeScalars = false

Palmetto.switch.mac[*].address = "auto"
Palmetto.switch.mac[*].mtu = 1500
Palmetto.switch.mac[*].promiscuous = true
Palmetto.switch.mac[*].queueModule = ""
Palmetto.switch.mac[*].txQueueLimit = 16384
Palmetto.switch.mac[*].writeScalars = false

#
# Uses a Broadcom BCM5708 using the bnx2 Linux driver
#
Palmetto.**.eth[*].queueType = "DropTailQueue"
Palmetto.**.eth[*].queue.frameCapacity = 256
Palmetto.**.eth[*].mac.promiscuous = false
Palmetto.**.eth[*].mac.address = "auto"
Palmetto.**.eth[*].mac.mtu = 1500
Palmetto.**.eth[*].mac.txQueueLimit = 256
Palmetto.**.eth[*].mac.queueModule = ""
Palmetto.**.eth[*].mac.writeScalars = false
Palmetto.**.eth[*].encap.writeScalars = false
Palmetto.**.ppp[*].queueType = "DropTailQueue"
Palmetto.**.ppp[*].queue.frameCapacity = 0

#
# Time to perform TCP/Userspace memory operations
#
Palmetto.**.hca.networkLayer.ip.procDelay = 0.000000481
#Palmetto.**.hca.networkLayer.ip.procDelay = 0.00000085

# Various INET configuration settings
Palmetto.**.hca.namid = -1
Palmetto.**.hca.routingFile = ""
Palmetto.**.hca.routingFile = ""
Palmetto.**.hca.IPForward = 0
Palmetto.**.hca.networkLayer.arp.retryTimeout = 1
Palmetto.**.hca.networkLayer.arp.retryCount = 3
Palmetto.**.hca.networkLayer.arp.cacheTimeout = 100
Palmetto.**.hca.networkLayer.proxyARP = false

###############################################################################
#
# Settings for all TCP connections
#
# Jumbo frames (9000 bytes) don't seem to work, but increasing MSS does
# appear to improve utilization
#
###############################################################################
**.tcp.recordStats = 0
**.tcp.mss = 1460 # bytes
#**.tcp.mss = 1355 # bytes
#**.tcp.advertisedWindow = 11680
**.tcp.advertisedWindow = 1460
**.tcp.tcpAlgorithmClass = "TCPReno"
**.tcp.sendQueueClass = "TCPMsgBasedSendQueue"
**.tcp.receiveQueueClass = "TCPMsgBasedRcvQueue"


##############################################################################
#
# UDP Applications (disabled)
#
##############################################################################
**.numUdpApps=0 # 0 means no UDP apps active.
**.udpAppType="UDPBasicApp"


##############################################################################
#
# Ping Application (disabled)
#
##############################################################################
Palmetto.cpun[0].hca.pingApp.destAddr = "192.168.0.2"   
Palmetto.**.hca.pingApp.destAddr=""	# Empty destAddr ensures the ping app won't start
**.pingApp.srcAddr=""
**.pingApp.packetSize=56
**.pingApp.interval=1
**.pingApp.hopLimit=32
**.pingApp.count=0
**.pingApp.startTime=1
**.pingApp.stopTime=31
**.pingApp.printPing=true


[Run 1]
Palmetto.numIONodes = 1

[Run 2]
Palmetto.numIONodes = 2

[Run 4]
Palmetto.numIONodes = 4

[Run 5]
Palmetto.numIONodes = 5

[Run 8]
Palmetto.numIONodes = 8

[Run 10]
Palmetto.numIONodes = 10

[Run 14]
Palmetto.numIONodes = 14

[Run 15]
Palmetto.numIONodes = 15

[Run 16]
Palmetto.numIONodes = 16

[Run 20]
Palmetto.numIONodes = 20

[Run 25]
Palmetto.numIONodes = 25

[Run 30]
Palmetto.numIONodes = 30

[Run 40]
Palmetto.numIONodes = 40

[Run 50]
Palmetto.numIONodes = 50

[Run 60]
Palmetto.numIONodes = 60

[Run 70]
Palmetto.numIONodes = 70

[Run 80]
Palmetto.numIONodes = 80

[Run 90]
Palmetto.numIONodes = 90

[Run 100]
Palmetto.numIONodes = 100
